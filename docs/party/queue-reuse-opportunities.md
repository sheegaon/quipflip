# Party queue reuse audit

## Context
Party mode currently coordinates its own prompt, copy, and vote flows while the general game queues already hold waiting prompts and phrasesets. The goal is to reuse that existing content—especially when AI is filling seats—so we avoid generating fresh quips when suitable material is already available.

## Findings
1. **AI copy submissions ignore the preselected prompt.** The AI path picks a prompt via `_get_eligible_prompt_for_copy`, but `start_party_copy_round` is invoked without that prompt ID. The round is therefore matched to whatever the copy starter would normally pull (party or global queue), which can mismatch the AI-generated impostor phrase and misses the chance to intentionally reuse the selected queued prompt. 【F:backend/services/qf/party_coordination_service.py†L821-L866】
2. **Voting never falls back to the global phraseset queue.** `_get_eligible_phraseset_for_vote` returns `None` when no party phrasesets are ready, and `start_party_vote_round` immediately raises `NoPhrasesetsAvailableError` rather than pulling from the general voting queue. Players in party mode can be blocked even if the normal queue has completed phrasesets available for reuse. 【F:backend/services/qf/party_coordination_service.py†L449-L456】【F:backend/services/qf/party_coordination_service.py†L627-L695】
3. **AI prompt/copy generation always creates new content.** AI participants generate fresh prompts and copies through `ai_service` calls instead of first reusing waiting prompts/copies authored outside the current party. The coordination service has access to the queue-backed round creation (`RoundService.start_copy_round` already pulls from the prompt queue), but the AI prompt path never attempts to adopt queued prompts, and the copy path’s prompt selection does not filter out party authors when it falls back to the global queue. 【F:backend/services/qf/party_coordination_service.py†L120-L178】【F:backend/services/qf/party_coordination_service.py†L600-L625】【F:backend/services/qf/party_coordination_service.py†L732-L866】

## Recommendations
- **Thread the chosen prompt into AI copy rounds.** Extend `start_party_copy_round` to accept an optional `prompt_round_id` so AI copy submissions can lock onto the prompt already selected by `_get_eligible_prompt_for_copy`, guaranteeing we reuse that queued content instead of rematching mid-call.
- **Add global phraseset reuse for voting.** When `_get_eligible_phraseset_for_vote` finds no party options, pull IDs from `QueueService`’s phraseset queue (excluding any authored by party participants) before failing. This lets party players vote on existing completed sets rather than idling.
- **Prefer queue-fed content for AI prompts and copies.** Before calling `ai_service` to create new quips, try adopting prompt rounds from the global prompt queue whose authors are outside the current party. Similarly, allow AI copies to reuse queued prompts from other sessions while filtering out anything written by a party participant; only fall back to generation when no safe reuse candidates remain.
- **Track provenance in responses.** When reusing queued items, surface the source (e.g., `reuse_source: "global_queue"`) in party context so the frontend can message that AI filled with community content rather than newly generated quips.
