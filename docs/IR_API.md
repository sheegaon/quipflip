# Initial Reaction (IR) API Documentation

## Base URL

```
Development: http://localhost:8000/ir
```

## Authentication

- HTTP-only cookies are set on login/registration/guest/upgrade/refresh using `ir_access_token` (2 hours) and `ir_refresh_token` (30 days).
- Authorization headers (`Bearer <token>`) are also accepted by the IR auth dependency.
- Most endpoints require authentication; unauthenticated access is only allowed where noted (e.g., registration and guest creation).

## Core Models

Field-level schemas live in the backend Pydantic models under `backend/routers/ir/schemas.py`. Key shapes used by the API responses include:

- `IRAuthResponse`: tokens plus `player` profile; guest creation also returns generated `email`/`password`.
- `IRPlayerResponse`: canonical player profile (ID, username, email, wallet, vault, created_at, guest/admin flags).
- `BackronymSet`, `BackronymEntry`, `BackronymVote`: round status, entry/vote metadata, and payout fields.

---

## Auth Endpoints

- `POST /auth/register` – Create an account with `username`, `email`, and `password`; sets auth cookies and returns tokens plus profile.
- `POST /auth/login` – Sign in with `username` and `password`; sets cookies and returns tokens plus profile.
- `POST /auth/guest` – Create a guest player; sets cookies and returns tokens plus guest profile and autogenerated credentials.
- `POST /auth/upgrade` – Convert a guest to a registered player with `email` and `password`; returns fresh tokens and profile.
- `POST /auth/refresh` – Exchange a refresh token (cookie or body) for a new access token and refresh token; updates cookies.
- `POST /auth/logout` – Clear access and refresh cookies.

## Player Endpoints

- `GET /me` – Return the authenticated player's profile.
- `GET /player/balance` – Fetch wallet, vault, and `daily_bonus_available` flag.
- `GET /player/dashboard` – Summary combining player info, active set (if any), pending results, wallet, vault, and daily bonus flag.
- `POST /player/claim-daily-bonus` – Claim the daily bonus; returns awarded amount, new balance, and next availability timestamp.
- `GET /players/{player_id}` – Public profile lookup by ID.

## Game Endpoints

- `POST /start` – Join an open backronym set or create one; debits the entry fee. Response includes `set_id`, `word`, `mode`, and `status`.
- `POST /sets/{set_id}/validate` – Validate a list of words against the set's target length using the validator service.
- `POST /sets/{set_id}/submit` – Submit a backronym entry (`words`) for the set.
- `GET /sets/{set_id}/status` – Return current set status, counts, player submission/vote flags, and timestamps.
- `POST /sets/{set_id}/vote` – Submit a vote for an entry; debits non-participant voters before recording.
- `GET /sets/{set_id}/results` – For finalized sets, return entries, votes, the caller's entry/vote (if any), payout breakdown, and set summary.

## Stats & Leaderboards

- `GET /player/statistics` – Aggregate totals for entries, votes, and wins for the authenticated player.
- `GET /leaderboards/creators` – Top creators by wins and vote totals.
- `GET /leaderboards/voters` – Top voters by correct picks.
